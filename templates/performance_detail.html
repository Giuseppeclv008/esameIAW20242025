{% extends "base_festival.html" %}

{% block title %}{{ performance.artist_name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-5">
            <img src="{{ url_for('static', filename=performance.image_path or 'images/misc/placeholder.png') }}"
                class="img-fluid rounded shadow" alt="{{ performance.artist_name }}">
            {% if current_user.is_authenticated and current_user.role == 'organizer'%}
            <div class="mt-3">
                {% if not performance.is_published %}
                {% if current_user.is_authenticated and current_user.role == 'organizer' and performance.organizer_id ==
                current_user.id and not performance.is_published %}
                <a href="{{ url_for('manage_performance', perf_id=performance.id) }}" class="btn btn-secondary">Edit
                    Draft</a>
                <form action="{{ url_for('publish_performance', perf_id=performance.id) }}" method="POST"
                    style="display: inline;">
                    <button type="submit" class="btn btn-primary">Publish Performance</button>
                </form>
                {% endif %}
                {% if current_user.is_authenticated and current_user.role == 'organizer' and performance.organizer_id !=
                current_user.id %}
                <p class="mt-2 text-danger"><small>This draft is from organizer: {{ performance.organizer_id }}</small>
                    {% endif %}
                <p class="mt-2 text-warning">This is a draft and only visible to you.</p>
                {% else %}
                <p class="mt-2 text-success"><small>This performance is published.</small></p>
                {% endif %}
            </div>
            {% endif %}
        </div>
        <div class="col-md-7">
            <h1 style="font-family: 'Playfair Display', serif;">{{ performance.artist_name }}</h1>
            <p class="lead">Genre: {{ performance.genre }}</p>
            <hr>
            <h4 style="font-family: 'Playfair Display', serif;">Details</h4>
            <ul class="list-unstyled">
                <li style="font-family: 'Playfair Display', serif;"><strong>Day:</strong> {{ performance.day }}</li>
                <li style="font-family: 'Playfair Display', serif;"><strong>Time:</strong> {{ performance.start_time }}
                </li>
                <li style="font-family: 'Playfair Display', serif;"><strong>Duration:</strong> {{
                    performance.duration_minutes }} minutes</li>
                <li style="font-family: 'Playfair Display', serif;"><strong>Stage:</strong> {{ performance.stage_name }}
                </li>
                <li style="font-family: 'Playfair Display', serif;"><strong>Organized by:</strong> {{
                    performance.organizer_nickname }}</li>
            </ul>

            <h4 style="font-family: 'Playfair Display', serif;">Description</h4>
            <p>{{ performance.description | safe }}</p> {# Use safe if description can contain HTML from trusted source
            #}

            {% if can_buy_ticket %}
            <div class="mt-4 p-3 bg-light rounded">
                <h4>Interested?</h4>
                <p>You can purchase tickets to attend this and other performances!</p>
                <a href="{{ url_for('buy_ticket') }}" class="btn mypurchasebtn btn-lg">Buy Tickets</a>
            </div>
            {% elif current_user.is_authenticated and current_user.role == 'participant' %}
            <div class="mt-4 p-3 bg-light rounded">
                <p>You already have a ticket for this festival. Check your <a href="{{url_for('profile')}}">profile</a>.
                </p>
            </div>
            {% elif current_user.is_authenticated and current_user.role == 'organizer' %}
            <div class="mt-4 p-3 bg-light rounded">
                <p>Organizers can browse performances but cannot purchase tickets.</p>
            </div>
            {% elif not current_user.is_authenticated %}
            <div class="mt-4 p-3 bg-light rounded">
                <p>
                    <a type="button" href="{{url_for('login', next=request.url)}}"
                        class="btn btn-primary unreg_btn mybuttoncolors">
                        Log in
                    </a>
                    or <a type="button" class="btn btn-primary unreg_btn mybuttoncolors"
                        href="{{url_for('register')}}">register</a> as
                    a participant to buy tickets!
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}